<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Aprendizaje de máquina</title>
  <meta name="description" content="Notas y material para el curso de aprendizaje de máquina (ITAM)">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Aprendizaje de máquina" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Notas y material para el curso de aprendizaje de máquina (ITAM)" />
  <meta name="github-repo" content="felipegonzalez/aprendizaje-maquina-mcd" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Aprendizaje de máquina" />
  
  <meta name="twitter:description" content="Notas y material para el curso de aprendizaje de máquina (ITAM)" />
  

<meta name="author" content="Felipe González">


<meta name="date" content="2018-09-30">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="regularizacion.html">
<link rel="next" href="redes-neuronales-parte-1.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="css/toc.css" type="text/css" />
<link rel="stylesheet" href="css/font-awesome.min.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Aprendizaje Máquina</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Temario y referencias</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#evaluacion"><i class="fa fa-check"></i>Evaluación</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-r-y-rstudio"><i class="fa fa-check"></i>Software: R y Rstudio</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#referencias-principales"><i class="fa fa-check"></i>Referencias principales</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#otras-referencias"><i class="fa fa-check"></i>Otras referencias</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduccion.html"><a href="introduccion.html"><i class="fa fa-check"></i><b>1</b> Introducción</a><ul>
<li class="chapter" data-level="1.1" data-path="introduccion.html"><a href="introduccion.html#que-es-aprendizaje-de-maquina-machine-learning"><i class="fa fa-check"></i><b>1.1</b> ¿Qué es aprendizaje de máquina (machine learning)?</a></li>
<li class="chapter" data-level="1.2" data-path="introduccion.html"><a href="introduccion.html#aprendizaje-supervisado-1"><i class="fa fa-check"></i><b>1.2</b> Aprendizaje Supervisado</a><ul>
<li class="chapter" data-level="" data-path="introduccion.html"><a href="introduccion.html#proceso-generador-de-datos-modelo-teorico"><i class="fa fa-check"></i>Proceso generador de datos (modelo teórico)</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="introduccion.html"><a href="introduccion.html#predicciones"><i class="fa fa-check"></i><b>1.3</b> Predicciones</a></li>
<li class="chapter" data-level="1.4" data-path="introduccion.html"><a href="introduccion.html#aprendizaje"><i class="fa fa-check"></i><b>1.4</b> Tarea de aprendizaje supervisado</a></li>
<li class="chapter" data-level="1.5" data-path="introduccion.html"><a href="introduccion.html#error"><i class="fa fa-check"></i><b>1.5</b> Balance de complejidad y rigidez</a></li>
<li class="chapter" data-level="1.6" data-path="introduccion.html"><a href="introduccion.html#como-estimar-f"><i class="fa fa-check"></i><b>1.6</b> ¿Cómo estimar f?</a></li>
<li class="chapter" data-level="1.7" data-path="introduccion.html"><a href="introduccion.html#resumen"><i class="fa fa-check"></i><b>1.7</b> Resumen</a></li>
<li class="chapter" data-level="1.8" data-path="introduccion.html"><a href="introduccion.html#tarea"><i class="fa fa-check"></i><b>1.8</b> Tarea</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="regresion.html"><a href="regresion.html"><i class="fa fa-check"></i><b>2</b> Regresión lineal</a><ul>
<li class="chapter" data-level="2.1" data-path="introduccion.html"><a href="introduccion.html#introduccion"><i class="fa fa-check"></i><b>2.1</b> Introducción</a></li>
<li class="chapter" data-level="2.2" data-path="regresion.html"><a href="regresion.html#aprendizaje-de-coeficientes-ajuste"><i class="fa fa-check"></i><b>2.2</b> Aprendizaje de coeficientes (ajuste)</a></li>
<li class="chapter" data-level="2.3" data-path="regresion.html"><a href="regresion.html#descenso-en-gradiente"><i class="fa fa-check"></i><b>2.3</b> Descenso en gradiente</a><ul>
<li class="chapter" data-level="2.3.1" data-path="regresion.html"><a href="regresion.html#seleccion-de-tamano-de-paso-eta"><i class="fa fa-check"></i><b>2.3.1</b> Selección de tamaño de paso <span class="math inline">\(\eta\)</span></a></li>
<li class="chapter" data-level="2.3.2" data-path="regresion.html"><a href="regresion.html#funciones-de-varias-variables"><i class="fa fa-check"></i><b>2.3.2</b> Funciones de varias variables</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="regresion.html"><a href="regresion.html#descenso-en-gradiente-para-regresion-lineal"><i class="fa fa-check"></i><b>2.4</b> Descenso en gradiente para regresión lineal</a></li>
<li class="chapter" data-level="2.5" data-path="regresion.html"><a href="regresion.html#normalizacion-de-entradas"><i class="fa fa-check"></i><b>2.5</b> Normalización de entradas</a></li>
<li class="chapter" data-level="2.6" data-path="regresion.html"><a href="regresion.html#interpretacion-de-modelos-lineales"><i class="fa fa-check"></i><b>2.6</b> Interpretación de modelos lineales</a></li>
<li class="chapter" data-level="2.7" data-path="regresion.html"><a href="regresion.html#solucion-analitica"><i class="fa fa-check"></i><b>2.7</b> Solución analítica</a></li>
<li class="chapter" data-level="2.8" data-path="regresion.html"><a href="regresion.html#por-que-el-modelo-lineal-funciona-bien-muchas-veces"><i class="fa fa-check"></i><b>2.8</b> ¿Por qué el modelo lineal funciona bien (muchas veces)?</a><ul>
<li class="chapter" data-level="2.8.1" data-path="regresion.html"><a href="regresion.html#k-vecinos-mas-cercanos"><i class="fa fa-check"></i><b>2.8.1</b> k vecinos más cercanos</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="regresion.html"><a href="regresion.html#tarea-1"><i class="fa fa-check"></i>Tarea</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="logistica.html"><a href="logistica.html"><i class="fa fa-check"></i><b>3</b> Regresión logística</a><ul>
<li class="chapter" data-level="3.1" data-path="logistica.html"><a href="logistica.html#el-problema-de-clasificacion"><i class="fa fa-check"></i><b>3.1</b> El problema de clasificación</a><ul>
<li class="chapter" data-level="" data-path="logistica.html"><a href="logistica.html#que-estimar-en-problemas-de-clasificacion"><i class="fa fa-check"></i>¿Qué estimar en problemas de clasificación?</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="logistica.html"><a href="logistica.html#estimacion-de-probabilidades-de-clase"><i class="fa fa-check"></i><b>3.2</b> Estimación de probabilidades de clase</a><ul>
<li class="chapter" data-level="" data-path="logistica.html"><a href="logistica.html#ejemplo-9"><i class="fa fa-check"></i>Ejemplo</a></li>
<li class="chapter" data-level="3.2.1" data-path="logistica.html"><a href="logistica.html#k-vecinos-mas-cercanos-1"><i class="fa fa-check"></i><b>3.2.1</b> k-vecinos más cercanos</a></li>
<li class="chapter" data-level="" data-path="logistica.html"><a href="logistica.html#ejemplo-11"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="logistica.html"><a href="logistica.html#error-para-modelos-de-clasificacion"><i class="fa fa-check"></i><b>3.3</b> Error para modelos de clasificación</a><ul>
<li class="chapter" data-level="3.3.1" data-path="logistica.html"><a href="logistica.html#ejercicio-1"><i class="fa fa-check"></i><b>3.3.1</b> Ejercicio</a></li>
<li class="chapter" data-level="3.3.2" data-path="logistica.html"><a href="logistica.html#error-de-clasificacion-y-funcion-de-perdida-0-1"><i class="fa fa-check"></i><b>3.3.2</b> Error de clasificación y función de pérdida 0-1</a></li>
<li class="chapter" data-level="3.3.3" data-path="logistica.html"><a href="logistica.html#discusion-relacion-entre-devianza-y-error-de-clasificacion"><i class="fa fa-check"></i><b>3.3.3</b> Discusión: relación entre devianza y error de clasificación</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="logistica.html"><a href="logistica.html#regresion-logistica"><i class="fa fa-check"></i><b>3.4</b> Regresión logística</a><ul>
<li class="chapter" data-level="3.4.1" data-path="logistica.html"><a href="logistica.html#regresion-logistica-simple"><i class="fa fa-check"></i><b>3.4.1</b> Regresión logística simple</a></li>
<li class="chapter" data-level="3.4.2" data-path="logistica.html"><a href="logistica.html#funcion-logistica"><i class="fa fa-check"></i><b>3.4.2</b> Función logística</a></li>
<li class="chapter" data-level="3.4.3" data-path="logistica.html"><a href="logistica.html#regresion-logistica-1"><i class="fa fa-check"></i><b>3.4.3</b> Regresión logística</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="logistica.html"><a href="logistica.html#aprendizaje-de-coeficientes-para-regresion-logistica-binomial."><i class="fa fa-check"></i><b>3.5</b> Aprendizaje de coeficientes para regresión logística (binomial).</a></li>
<li class="chapter" data-level="3.6" data-path="logistica.html"><a href="logistica.html#ejercicio-datos-de-diabetes"><i class="fa fa-check"></i><b>3.6</b> Ejercicio: datos de diabetes</a><ul>
<li class="chapter" data-level="" data-path="logistica.html"><a href="logistica.html#tarea-2"><i class="fa fa-check"></i>Tarea</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mas-sobre-problemas-de-clasificacion.html"><a href="mas-sobre-problemas-de-clasificacion.html"><i class="fa fa-check"></i><b>4</b> Más sobre problemas de clasificación</a><ul>
<li class="chapter" data-level="4.1" data-path="mas-sobre-problemas-de-clasificacion.html"><a href="mas-sobre-problemas-de-clasificacion.html#analisis-de-error-para-clasificadores-binarios"><i class="fa fa-check"></i><b>4.1</b> Análisis de error para clasificadores binarios</a><ul>
<li class="chapter" data-level="" data-path="mas-sobre-problemas-de-clasificacion.html"><a href="mas-sobre-problemas-de-clasificacion.html#medidas-resumen-de-desempeno"><i class="fa fa-check"></i>Medidas resumen de desempeño</a></li>
<li class="chapter" data-level="" data-path="mas-sobre-problemas-de-clasificacion.html"><a href="mas-sobre-problemas-de-clasificacion.html#interpetacion-de-resumenes-de-desempeno-y-tasas-base"><i class="fa fa-check"></i>Interpetación de resúmenes de desempeño y tasas base</a></li>
<li class="chapter" data-level="4.1.1" data-path="mas-sobre-problemas-de-clasificacion.html"><a href="mas-sobre-problemas-de-clasificacion.html#puntos-de-corte-para-un-clasificador-binario"><i class="fa fa-check"></i><b>4.1.1</b> Puntos de corte para un clasificador binario</a></li>
<li class="chapter" data-level="4.1.2" data-path="mas-sobre-problemas-de-clasificacion.html"><a href="mas-sobre-problemas-de-clasificacion.html#espacio-roc-de-clasificadores"><i class="fa fa-check"></i><b>4.1.2</b> Espacio ROC de clasificadores</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="mas-sobre-problemas-de-clasificacion.html"><a href="mas-sobre-problemas-de-clasificacion.html#perfil-de-un-clasificador-binario-y-curvas-roc"><i class="fa fa-check"></i><b>4.2</b> Perfil de un clasificador binario y curvas ROC</a></li>
<li class="chapter" data-level="4.3" data-path="mas-sobre-problemas-de-clasificacion.html"><a href="mas-sobre-problemas-de-clasificacion.html#regresion-logistica-para-problemas-de-mas-de-2-clases"><i class="fa fa-check"></i><b>4.3</b> Regresión logística para problemas de más de 2 clases</a><ul>
<li class="chapter" data-level="4.3.1" data-path="mas-sobre-problemas-de-clasificacion.html"><a href="mas-sobre-problemas-de-clasificacion.html#regresion-logistica-multinomial"><i class="fa fa-check"></i><b>4.3.1</b> Regresión logística multinomial</a></li>
<li class="chapter" data-level="4.3.2" data-path="mas-sobre-problemas-de-clasificacion.html"><a href="mas-sobre-problemas-de-clasificacion.html#interpretacion-de-coeficientes"><i class="fa fa-check"></i><b>4.3.2</b> Interpretación de coeficientes</a></li>
<li class="chapter" data-level="4.3.3" data-path="mas-sobre-problemas-de-clasificacion.html"><a href="mas-sobre-problemas-de-clasificacion.html#ejemplo-clasificacion-de-digitos-con-regresion-multinomial"><i class="fa fa-check"></i><b>4.3.3</b> Ejemplo: Clasificación de dígitos con regresión multinomial</a></li>
<li class="chapter" data-level="" data-path="mas-sobre-problemas-de-clasificacion.html"><a href="mas-sobre-problemas-de-clasificacion.html#discusion"><i class="fa fa-check"></i>Discusión</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="mas-sobre-problemas-de-clasificacion.html"><a href="mas-sobre-problemas-de-clasificacion.html#descenso-en-gradiente-para-regresion-multinomial-logistica"><i class="fa fa-check"></i><b>4.4</b> Descenso en gradiente para regresión multinomial logística</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="regularizacion.html"><a href="regularizacion.html"><i class="fa fa-check"></i><b>5</b> Regularización</a><ul>
<li class="chapter" data-level="5.1" data-path="regularizacion.html"><a href="regularizacion.html#sesgo-y-varianza-de-predictores"><i class="fa fa-check"></i><b>5.1</b> Sesgo y varianza de predictores</a><ul>
<li class="chapter" data-level="5.1.1" data-path="regularizacion.html"><a href="regularizacion.html#sesgo-y-varianza-en-modelos-lineales"><i class="fa fa-check"></i><b>5.1.1</b> Sesgo y varianza en modelos lineales</a></li>
<li class="chapter" data-level="5.1.2" data-path="regularizacion.html"><a href="regularizacion.html#reduciendo-varianza-de-los-coeficientes"><i class="fa fa-check"></i><b>5.1.2</b> Reduciendo varianza de los coeficientes</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="regularizacion.html"><a href="regularizacion.html#regularizacion-ridge"><i class="fa fa-check"></i><b>5.2</b> Regularización ridge</a><ul>
<li class="chapter" data-level="5.2.1" data-path="regularizacion.html"><a href="regularizacion.html#seleccion-de-coeficiente-de-regularizacion"><i class="fa fa-check"></i><b>5.2.1</b> Selección de coeficiente de regularización</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="regularizacion.html"><a href="regularizacion.html#entrenamiento-validacion-y-prueba"><i class="fa fa-check"></i><b>5.3</b> Entrenamiento, Validación y Prueba</a><ul>
<li class="chapter" data-level="5.3.1" data-path="regularizacion.html"><a href="regularizacion.html#validacion-cruzada"><i class="fa fa-check"></i><b>5.3.1</b> Validación cruzada</a></li>
<li class="chapter" data-level="5.3.2" data-path="regularizacion.html"><a href="regularizacion.html#como-se-desempena-validacion-cruzada-como-estimacion-del-error"><i class="fa fa-check"></i><b>5.3.2</b> ¿Cómo se desempeña validación cruzada como estimación del error?</a></li>
<li class="chapter" data-level="" data-path="regularizacion.html"><a href="regularizacion.html#ejercicio-4"><i class="fa fa-check"></i>Ejercicio</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="regularizacion.html"><a href="regularizacion.html#regularizacion-lasso"><i class="fa fa-check"></i><b>5.4</b> Regularización lasso</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="extensiones-para-regresion-lineal-y-logistica.html"><a href="extensiones-para-regresion-lineal-y-logistica.html"><i class="fa fa-check"></i><b>6</b> Extensiones para regresión lineal y logística</a><ul>
<li class="chapter" data-level="6.1" data-path="extensiones-para-regresion-lineal-y-logistica.html"><a href="extensiones-para-regresion-lineal-y-logistica.html#como-hacer-mas-flexible-el-modelo-lineal"><i class="fa fa-check"></i><b>6.1</b> Cómo hacer más flexible el modelo lineal</a></li>
<li class="chapter" data-level="6.2" data-path="extensiones-para-regresion-lineal-y-logistica.html"><a href="extensiones-para-regresion-lineal-y-logistica.html#transformacion-de-entradas"><i class="fa fa-check"></i><b>6.2</b> Transformación de entradas</a></li>
<li class="chapter" data-level="6.3" data-path="extensiones-para-regresion-lineal-y-logistica.html"><a href="extensiones-para-regresion-lineal-y-logistica.html#variables-cualitativas"><i class="fa fa-check"></i><b>6.3</b> Variables cualitativas</a></li>
<li class="chapter" data-level="6.4" data-path="extensiones-para-regresion-lineal-y-logistica.html"><a href="extensiones-para-regresion-lineal-y-logistica.html#interacciones"><i class="fa fa-check"></i><b>6.4</b> Interacciones</a></li>
<li class="chapter" data-level="6.5" data-path="extensiones-para-regresion-lineal-y-logistica.html"><a href="extensiones-para-regresion-lineal-y-logistica.html#categorizacion-de-variables"><i class="fa fa-check"></i><b>6.5</b> Categorización de variables</a></li>
<li class="chapter" data-level="6.6" data-path="extensiones-para-regresion-lineal-y-logistica.html"><a href="extensiones-para-regresion-lineal-y-logistica.html#splines-opcional"><i class="fa fa-check"></i><b>6.6</b> Splines (opcional)</a></li>
<li class="chapter" data-level="6.7" data-path="extensiones-para-regresion-lineal-y-logistica.html"><a href="extensiones-para-regresion-lineal-y-logistica.html#modelando-en-escala-logaritmica"><i class="fa fa-check"></i><b>6.7</b> Modelando en escala logarítmica</a><ul>
<li class="chapter" data-level="6.7.1" data-path="extensiones-para-regresion-lineal-y-logistica.html"><a href="extensiones-para-regresion-lineal-y-logistica.html#cuando-usar-estas-tecnicas"><i class="fa fa-check"></i><b>6.7.1</b> ¿Cuándo usar estas técnicas?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="redes-neuronales-parte-1.html"><a href="redes-neuronales-parte-1.html"><i class="fa fa-check"></i><b>7</b> Redes neuronales (parte 1)</a><ul>
<li class="chapter" data-level="7.1" data-path="redes-neuronales-parte-1.html"><a href="redes-neuronales-parte-1.html#introduccion-a-redes-neuronales"><i class="fa fa-check"></i><b>7.1</b> Introducción a redes neuronales</a><ul>
<li class="chapter" data-level="" data-path="redes-neuronales-parte-1.html"><a href="redes-neuronales-parte-1.html#como-construyen-entradas-las-redes-neuronales"><i class="fa fa-check"></i>¿Cómo construyen entradas las redes neuronales?</a></li>
<li class="chapter" data-level="" data-path="redes-neuronales-parte-1.html"><a href="redes-neuronales-parte-1.html#como-ajustar-los-parametros"><i class="fa fa-check"></i>¿Cómo ajustar los parámetros?</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="redes-neuronales-parte-1.html"><a href="redes-neuronales-parte-1.html#interacciones-en-redes-neuronales"><i class="fa fa-check"></i><b>7.2</b> Interacciones en redes neuronales</a></li>
<li class="chapter" data-level="7.3" data-path="redes-neuronales-parte-1.html"><a href="redes-neuronales-parte-1.html#calculo-en-redes-feed-forward"><i class="fa fa-check"></i><b>7.3</b> Cálculo en redes: feed-forward</a></li>
<li class="chapter" data-level="" data-path="redes-neuronales-parte-1.html"><a href="redes-neuronales-parte-1.html#notacion"><i class="fa fa-check"></i>Notación</a></li>
<li class="chapter" data-level="7.4" data-path="redes-neuronales-parte-1.html"><a href="redes-neuronales-parte-1.html#feed-forward"><i class="fa fa-check"></i><b>7.4</b> Feed forward</a></li>
<li class="chapter" data-level="7.5" data-path="redes-neuronales-parte-1.html"><a href="redes-neuronales-parte-1.html#backpropagation-calculo-del-gradiente-clasificacion-binaria"><i class="fa fa-check"></i><b>7.5</b> Backpropagation: cálculo del gradiente (clasificación binaria)</a><ul>
<li class="chapter" data-level="7.5.1" data-path="redes-neuronales-parte-1.html"><a href="redes-neuronales-parte-1.html#calculo-para-un-caso-de-entrenamiento"><i class="fa fa-check"></i><b>7.5.1</b> Cálculo para un caso de entrenamiento</a></li>
<li class="chapter" data-level="7.5.2" data-path="redes-neuronales-parte-1.html"><a href="redes-neuronales-parte-1.html#algoritmo-de-backpropagation"><i class="fa fa-check"></i><b>7.5.2</b> Algoritmo de backpropagation</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="redes-neuronales-parte-1.html"><a href="redes-neuronales-parte-1.html#ajuste-de-parametros-introduccion"><i class="fa fa-check"></i><b>7.6</b> Ajuste de parámetros (introducción)</a><ul>
<li class="chapter" data-level="7.6.1" data-path="redes-neuronales-parte-1.html"><a href="redes-neuronales-parte-1.html#ejemplo-35"><i class="fa fa-check"></i><b>7.6.1</b> Ejemplo</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Publicado con bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Aprendizaje de máquina</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="extensiones-para-regresion-lineal-y-logistica" class="section level1">
<h1><span class="header-section-number">Clase 6</span> Extensiones para regresión lineal y logística</h1>
<p>Los modelos lineales son modelos simples que tienen la ventaja de que
es relativamente fácil entender cómo contribuyen las variables de entrada
a la predicción
(simplemente describimos los coeficientes), y es relativamente fácil ajustarlos, y es fácil hacer cálculos con ellos.</p>
<p>Sin embargo, puede ser que sean pobres desde el punto de vista predictivo. Hay dos razones:</p>
<ol style="list-style-type: decimal">
<li><p>Los coeficientes tienen <strong>varianza</strong> alta,
de modo que las predicciones resultantes son inestables
(por ejemplo, por pocos datos o variables de entradas correlacionadas).
En este caso, vimos que con el enfoque de regularización ridge o lasso podemos
mejorar la estabilidad,
las predicciones, y obtener modelos más parsimoniosos.</p></li>
<li><p>El modelo tiene <strong>sesgo</strong> alto, en el sentido de que la estructura lineal
es deficiente para describir patrones claros e importantes en los datos. Este
problema puede suceder
cuando tenemos relaciones complejas entre las variables. Cuando hay relativamente
pocas entradas y
suficientes datos, puede ser posible ajustar estructuras más realistas y complejas.
Aunque veremos otros métodos para atacar este problema más adelante, a veces
extensiones
simples del modelo lineal pueden resolver este problema. Igualmente,
esperamos encontrar
mejores predicciones con modelos más realistas.</p></li>
</ol>
<div id="como-hacer-mas-flexible-el-modelo-lineal" class="section level2">
<h2><span class="header-section-number">6.1</span> Cómo hacer más flexible el modelo lineal</h2>

<div class="comentario">
Podemos construir modelos lineales más flexibles expandiendo el espacio de entradas con transformaciones y combinaciones de las variables originales de entrada.
</div>

<p>La idea básica es entonces transformar a nuevas entradas,
antes de ajustar un modelo:
<span class="math display">\[(x_1,...,x_p) \to (b_1(x),...,b_M (x)).\]</span></p>
<p>donde típicamente <span class="math inline">\(M\)</span> es mayor que <span class="math inline">\(p\)</span>. Entonces, en lugar de ajustar
el modelo lineal en las <span class="math inline">\(x_1,\ldots, x_p\)</span>, que es</p>
<p><span class="math display">\[ f(x) = \beta_0 + \sum_{i=1}^p \beta_jx_j\]</span></p>
<p>ajustamos un <em>modelo lineal en las entradas transformadas</em>:</p>
<p><span class="math display">\[ f(x) = \beta_0 +  \sum_{i=1}^M \beta_jb_j(x).\]</span></p>
<p>Como cada <span class="math inline">\(b_j\)</span> es una función que toma valores numéricos, podemos
considerarla como una <em>entrada derivada</em> de las entradas originales.</p>
<div id="ejemplo-27" class="section level4 unnumbered">
<h4>Ejemplo</h4>
<p>Si <span class="math inline">\(x_1\)</span> es compras totales de un cliente de tarjeta
de crédito, y <span class="math inline">\(x_2\)</span> es el número de compras, podemos crear
una entrada derivada <span class="math inline">\(b_1(x_1,x_2)=x_1/x_2\)</span> que representa el tamaño promedio
por compra. Podríamos entonces poner <span class="math inline">\(b_2(x_1,x_2)=x_1\)</span>, <span class="math inline">\(b_3(x_1,x_2)=x_2\)</span>,
y ajustar un modelo lineal usando las entradas derivadas <span class="math inline">\(b_1,b_2, b_3\)</span>.</p>
<p>Lo conveniente de este enfoque es que lo único que hacemos para
hacer más flexible el modelo es transformar en primer lugar las variables
de entrada (quizá produciendo más entradas que el número de variables originales).
Después construimos un modelo lineal, y todo lo que hemos visto aplica
sin cambios: el modelo sigue siendo lineal, pero el espacio de entradas
es diferente (generalmente expandido).</p>
<p>Veremos las siguientes técnicas:</p>
<ul>
<li>Agregar versiones transformadas de las variables de entrada</li>
<li>Incluir variables cualitativas (categóricas).</li>
<li>Interacciones entre variables: incluir términos de la forma <span class="math inline">\(x_1x_2\)</span></li>
<li>Regresión polinomial: incluír términos de la forma <span class="math inline">\(x_1^2\)</span>, <span class="math inline">\(x_1^3\)</span>, etcétera.</li>
<li>Splines de regresión.</li>
</ul>
</div>
</div>
<div id="transformacion-de-entradas" class="section level2">
<h2><span class="header-section-number">6.2</span> Transformación de entradas</h2>
<p>Una técnica útil para mejorar el sesgo de modelos de regresión
consiste en incluir o sustituir valores transformados de las
variables de entrada.</p>
<div id="ejemplo-agregar-entradas-transformadas" class="section level4 unnumbered">
<h4>Ejemplo: agregar entradas transformadas</h4>
<p>Empezamos por predecir el valor de una casa en función de calidad de terminados.</p>
<p>Preparamos los datos:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
cbbPalette &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;#000000&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>, <span class="st">&quot;#56B4E9&quot;</span>, <span class="st">&quot;#009E73&quot;</span>, <span class="st">&quot;#F0E442&quot;</span>, <span class="st">&quot;#0072B2&quot;</span>, <span class="st">&quot;#D55E00&quot;</span>, <span class="st">&quot;#CC79A7&quot;</span>)
<span class="kw">theme_set</span>(<span class="kw">theme_minimal</span>())
datos_casas &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;./tareas/tarea_6_datos/data_train.csv&#39;</span>, <span class="dt">na=</span><span class="st">&quot;&quot;</span>)
<span class="kw">set.seed</span>(<span class="dv">9911</span>)
indices_entrena &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(datos_casas), <span class="dv">1000</span>)
casas_e &lt;-<span class="st"> </span>datos_casas[indices_entrena, ] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">log_price =</span> <span class="kw">log</span>(SalePrice))
casas_p &lt;-<span class="st"> </span>datos_casas[<span class="op">-</span>indices_entrena, ] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">log_price =</span> <span class="kw">log</span>(SalePrice))</code></pre>
<p>Ajustamos el modelo y lo probamos</p>
<pre class="sourceCode r"><code class="sourceCode r">mod_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(SalePrice <span class="op">~</span><span class="st"> </span>OverallQual , <span class="dt">data =</span> casas_e)

calc_error &lt;-<span class="st"> </span><span class="cf">function</span>(mod,  datos_p, <span class="dt">y_name =</span> <span class="st">&quot;SalePrice&quot;</span>){
    preds &lt;-<span class="st"> </span><span class="kw">predict</span>(mod, <span class="dt">newdata =</span> datos_p)
    dat &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">pred =</span> preds, <span class="dt">observado =</span> datos_p[[y_name]])
    error &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>((preds <span class="op">-</span><span class="st"> </span>datos_p[[y_name]])<span class="op">^</span><span class="dv">2</span>))
    grafica &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> preds, <span class="dt">y =</span> observado)) <span class="op">+</span>
<span class="st">        </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span>
<span class="st">        </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="dv">1000</span>, <span class="dt">y=</span> <span class="dv">300000</span>, <span class="dt">label =</span> <span class="kw">paste0</span>(<span class="st">&quot;rmse &quot;</span>, <span class="kw">round</span>(error))) <span class="op">+</span>
<span class="st">        </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;loess&quot;</span>, <span class="dt">span =</span> <span class="dv">2</span>, <span class="dt">method.args=</span><span class="kw">list</span>(<span class="dt">family=</span> <span class="st">&quot;symmetric&quot;</span>))
    <span class="kw">print</span>(grafica)
    error
}

<span class="kw">calc_error</span>(mod_<span class="dv">1</span>, casas_p, <span class="st">&quot;SalePrice&quot;</span>)</code></pre>
<p><img src="06-extensiones-lineal_files/figure-html/unnamed-chunk-3-1.png" width="480" /></p>
<pre><code>## [1] 42180.17</code></pre>
<p>Y notamos que nuestras predicciones parecen estar sesgadas: tienden a ser bajas
cuando el valor de la casa es alto o bajo. Esto es signo de <strong>sesgo</strong>, y
usualmente implica que existen relaciones
no lineales en las variables que estamos considerando, o interacciones que no
estamos incluyendo en nuestro modelo.</p>
<p>Una técnica es agregar entradas derivadas de las que tenemos, usando transformaciones
no lineales. Por ejemplo, podríamos hacer:</p>
<pre class="sourceCode r"><code class="sourceCode r">mod_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(SalePrice <span class="op">~</span><span class="st"> </span>OverallQual <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(OverallQual<span class="op">^</span><span class="dv">2</span>) , <span class="dt">data =</span> casas_e)
<span class="kw">calc_error</span>(mod_<span class="dv">2</span>, casas_p, <span class="st">&quot;SalePrice&quot;</span>)</code></pre>
<p><img src="06-extensiones-lineal_files/figure-html/unnamed-chunk-4-1.png" width="480" /></p>
<pre><code>## [1] 40830</code></pre>
<p>Y redujimos el error de prueba. Esta reducción claramente proviene de una reducción
de sesgo, pues usamos un modelo más complejo (una variable adicional).</p>
<p>Ahora agregamos otras variables: el tamaño del área habitable, garage y sótano,
y condición general,</p>
<pre class="sourceCode r"><code class="sourceCode r">mod_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(SalePrice <span class="op">~</span><span class="st">  </span>OverallQual <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(OverallQual<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span>OverallCond  <span class="op">+</span><span class="st"> </span>
<span class="st">                </span>GrLivArea <span class="op">+</span><span class="st"> </span>TotalBsmtSF <span class="op">+</span><span class="st"> </span>GarageArea, 
            <span class="dt">data =</span> casas_e)
<span class="kw">calc_error</span>(mod_<span class="dv">3</span>, casas_p, <span class="st">&quot;SalePrice&quot;</span>)</code></pre>
<p><img src="06-extensiones-lineal_files/figure-html/unnamed-chunk-5-1.png" width="480" /></p>
<pre><code>## [1] 32933.89</code></pre>
<p>Podemos pensar en expandir el modelo de maneras distintas. Por ejemplo,
podríamos incluir la relación que hay entre tamaño del sótano y área habitable:</p>
<pre class="sourceCode r"><code class="sourceCode r">mod_<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(SalePrice <span class="op">~</span><span class="st">  </span>OverallQual <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(OverallQual<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span>GrLivArea <span class="op">+</span><span class="st"> </span>TotalBsmtSF <span class="op">+</span>
<span class="st">                </span>GarageArea <span class="op">+</span><span class="st"> </span>OverallCond <span class="op">+</span>
<span class="st">                </span><span class="kw">I</span>( TotalBsmtSF <span class="op">/</span><span class="st"> </span>GrLivArea) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>( GarageArea <span class="op">/</span><span class="st"> </span>GrLivArea), 
            <span class="dt">data =</span> casas_e)
<span class="kw">calc_error</span>(mod_<span class="dv">4</span>, casas_p, <span class="st">&quot;SalePrice&quot;</span>)</code></pre>
<p><img src="06-extensiones-lineal_files/figure-html/unnamed-chunk-6-1.png" width="480" /></p>
<pre><code>## [1] 32957.83</code></pre>
<p>Y estos cambios parecen no mejorar nuestro modelo.</p>
</div>
</div>
<div id="variables-cualitativas" class="section level2">
<h2><span class="header-section-number">6.3</span> Variables cualitativas</h2>
<p>Muchas veces queremos usar variables cualitativas como entradas de nuestro modelo.
Pero en la expresión</p>
<p><span class="math display">\[ f(x) = \beta_0 +  \sum_{i=1}^p \beta_jx_j,\]</span>
todas las entradas son numéricas. Podemos usar un truco simple para incluir
variables cualitativas</p>
<div id="ejemplo-28" class="section level4 unnumbered">
<h4>Ejemplo</h4>
<p>Supongamos que queremos incluir la variable <em>CentralAir</em>, si tiene aire acondicionado
central o no. Podemos ver en este análisis simple que, por ejemplo, controlando
por tamaño de la casa, agrega valor tener aire acondicionado central:</p>
<pre class="sourceCode r"><code class="sourceCode r">casas_e <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(CentralAir) <span class="op">%&gt;%</span><span class="st"> </span>count</code></pre>
<pre><code>## # A tibble: 2 x 2
## # Groups:   CentralAir [2]
##   CentralAir     n
##   &lt;chr&gt;      &lt;int&gt;
## 1 N             67
## 2 Y            933</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(casas_e, 
       <span class="kw">aes</span>(<span class="dt">x=</span>GrLivArea, <span class="dt">y=</span>SalePrice, <span class="dt">colour=</span>CentralAir, <span class="dt">group=</span>CentralAir)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha=</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&#39;lm&#39;</span>, <span class="dt">se=</span><span class="ot">FALSE</span>, <span class="dt">size=</span><span class="fl">1.5</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_y_log10</span>(<span class="dt">breaks=</span><span class="kw">c</span>(<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="dv">2</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">500</span>,<span class="dv">1000</span>,<span class="dv">2000</span>,<span class="dv">4000</span>,<span class="dv">8000</span>))</code></pre>
<p><img src="06-extensiones-lineal_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Podemos incluir de manera simple esta variable creando una variable <em>dummy</em> o
<em>indicadora</em>,
que toma el 1 cuando la casa tiene AC y 0 si no:</p>
<pre class="sourceCode r"><code class="sourceCode r">casas_e &lt;-<span class="st"> </span>casas_e <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">AC_present =</span> <span class="kw">as.numeric</span>(CentralAir <span class="op">==</span><span class="st"> &quot;Y&quot;</span>))
casas_e <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Id, CentralAir, AC_present)</code></pre>
<pre><code>## # A tibble: 1,000 x 3
##       Id CentralAir AC_present
##    &lt;int&gt; &lt;chr&gt;           &lt;dbl&gt;
##  1  1070 Y                   1
##  2   730 Y                   1
##  3  1326 N                   0
##  4  1193 Y                   1
##  5  1079 Y                   1
##  6    85 Y                   1
##  7  1143 Y                   1
##  8   910 Y                   1
##  9  1063 N                   0
## 10   371 Y                   1
## # ... with 990 more rows</code></pre>
<p>Y ahora podemos hacer:</p>
<pre class="sourceCode r"><code class="sourceCode r">mod_<span class="dv">5</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(SalePrice <span class="op">~</span><span class="st">  </span>OverallQual <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(OverallQual<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span>GrLivArea <span class="op">+</span><span class="st"> </span>TotalBsmtSF <span class="op">+</span>
<span class="st">                </span>GarageArea <span class="op">+</span><span class="st"> </span>OverallCond <span class="op">+</span><span class="st"> </span>CentralAir, 
            <span class="dt">data =</span> casas_e)
<span class="kw">calc_error</span>(mod_<span class="dv">5</span>, casas_p, <span class="st">&quot;SalePrice&quot;</span>)</code></pre>
<p><img src="06-extensiones-lineal_files/figure-html/unnamed-chunk-9-1.png" width="480" /></p>
<pre><code>## [1] 32755.62</code></pre>
<p>Que no es una gran mejora, pero esperado dado que pocas de estas casas tienen aire acondicionado.</p>
<p>Cuando la variable categórica tiene <span class="math inline">\(K\)</span> clases,
solo creamos variables indicadores de las primeras <span class="math inline">\(K-1\)</span> clases, pues
la dummy de la última clase tiene información redundante: es decir, si
para las primeras <span class="math inline">\(K-1\)</span> clases las variables dummy son cero, entonces
ya sabemos que se trata de la última clase <span class="math inline">\(K\)</span>, y no necesitamos incluir
una indicadora para la última clase.</p>
</div>
<div id="ejemplo-29" class="section level4 unnumbered">
<h4>Ejemplo</h4>
<p>Vamos a incluir la variable BsmtQual, que tiene los niveles:</p>
<pre class="sourceCode r"><code class="sourceCode r">casas_e <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(BsmtQual) <span class="op">%&gt;%</span><span class="st"> </span>count</code></pre>
<pre><code>## # A tibble: 5 x 2
## # Groups:   BsmtQual [5]
##   BsmtQual     n
##   &lt;chr&gt;    &lt;int&gt;
## 1 Ex          93
## 2 Fa          26
## 3 Gd         409
## 4 NA          27
## 5 TA         445</code></pre>
<p>Podemos hacer una gráfica exploratoria como la anterior:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(casas_e, 
       <span class="kw">aes</span>(<span class="dt">x=</span>GrLivArea, <span class="dt">y=</span>SalePrice, <span class="dt">colour=</span>BsmtQual, <span class="dt">group=</span>BsmtQual)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha=</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&#39;lm&#39;</span>, <span class="dt">se=</span><span class="ot">FALSE</span>, <span class="dt">size=</span><span class="fl">1.5</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_y_log10</span>(<span class="dt">breaks=</span><span class="kw">c</span>(<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="dv">2</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">500</span>,<span class="dv">1000</span>,<span class="dv">2000</span>,<span class="dv">4000</span>,<span class="dv">8000</span>))</code></pre>
<p><img src="06-extensiones-lineal_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>donde vemos que esta variable puede aportar a la predicción. Ajustamos y evaluamos:</p>
<pre class="sourceCode r"><code class="sourceCode r">mod_<span class="dv">6</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(SalePrice <span class="op">~</span><span class="st">  </span>OverallQual <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(OverallQual<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span>GrLivArea <span class="op">+</span><span class="st"> </span>TotalBsmtSF <span class="op">+</span>
<span class="st">                </span>GarageArea <span class="op">+</span><span class="st"> </span>OverallCond <span class="op">+</span><span class="st"> </span>CentralAir <span class="op">+</span><span class="st"> </span>BsmtQual, 
            <span class="dt">data =</span> casas_e)
<span class="kw">calc_error</span>(mod_<span class="dv">6</span>, casas_p, <span class="st">&quot;SalePrice&quot;</span>)</code></pre>
<p><img src="06-extensiones-lineal_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<pre><code>## [1] 31340.03</code></pre>
<p>Si examinamos los coeficientes, vemos que <em>lm</em> automáticamente convirtió esta variable
con <em>dummy coding</em>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(mod_<span class="dv">6</span>)</code></pre>
<pre><code>##      (Intercept)      OverallQual I(OverallQual^2)        GrLivArea 
##     119263.78011     -44860.91908       5157.93509         49.39657 
##      TotalBsmtSF       GarageArea      OverallCond      CentralAirY 
##         19.98058         40.75125       6905.50493      22902.19901 
##       BsmtQualFa       BsmtQualGd       BsmtQualNA       BsmtQualTA 
##     -66355.09397     -34231.48579     -50546.75887     -54621.42055</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">bsmt_ind  &lt;-<span class="st"> </span><span class="kw">str_detect</span>(<span class="kw">names</span>(<span class="kw">coef</span>(mod_<span class="dv">6</span>)), <span class="st">&quot;BsmtQual&quot;</span>)
<span class="kw">coef</span>(mod_<span class="dv">6</span>)[bsmt_ind] <span class="op">%&gt;%</span><span class="st"> </span>sort</code></pre>
<pre><code>## BsmtQualFa BsmtQualTA BsmtQualNA BsmtQualGd 
##  -66355.09  -54621.42  -50546.76  -34231.49</code></pre>
<p>Nótese que la categoría base (con coeficiente 0 es ‘Ex’, es decir, no aparece TotalBsmtEx).
Esta es la razón por la que todos estos coeficientes son negativos (Ex es el mejor nivel).</p>
<hr />
<p><strong>Observaciones</strong>:
- Nótese también que no hay coeficiente para una de las clases, por lo que discutimos arriba. También podemos pensar que el coeficiente de esta clase es 0, y así comparamos con las otras clases.
- Cuando tenemos variables dummy, el intercept se interpreta con el nivel esperado cuando las variables cuantitativas valen cero, y la variable categórica toma la clase que se excluyó en la construcción de las indicadoras.</p>

<div class="comentario">
Podemos incluir variables cualitativas usando este truco de codificación
dummy (también llamado a veces <em>one-hot encoding</em>). Ojo: variables con muchas
categorías pueden inducir varianza alta en el modelo
(dependiendo del tamaño de los datos). En estos
casos conviene usar regularización y quizá (si es razonable) usar categorizaciones
más gruesas.
</div>

<p>En nuestro ejemplo anterior, observamos que el nivel <em>Fair</em> queda por debajo de <em>Typical</em> y <em>NA</em>. Esto
podría se un signo de sobreajuste (estimación con alta varianza de estos coeficientes).</p>
</div>
</div>
<div id="interacciones" class="section level2">
<h2><span class="header-section-number">6.4</span> Interacciones</h2>
<p>En el modelo lineal, cada variable contribuye de la misma manera independientemente de los valores de las otras variables. Esta es un simplificación o aproximación útil,
pero muchas veces puede producir sesgo demasiado grande en el modelo.
Por ejemplo: consideremos los siguientes datos de la relación de mediciones de temperatura y ozono en la atmósfera:</p>
<div id="ejemplo-30" class="section level4 unnumbered">
<h4>Ejemplo</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(airquality)</code></pre>
<pre><code>##   Ozone Solar.R Wind Temp Month Day
## 1    41     190  7.4   67     5   1
## 2    36     118  8.0   72     5   2
## 3    12     149 12.6   74     5   3
## 4    18     313 11.5   62     5   4
## 5    NA      NA 14.3   56     5   5
## 6    28      NA 14.9   66     5   6</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">air &lt;-<span class="st"> </span><span class="kw">filter</span>(airquality, <span class="op">!</span><span class="kw">is.na</span>(Ozone) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(Wind) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(Temp))
<span class="kw">lm</span>(Ozone <span class="op">~</span>Temp, <span class="dt">data =</span> air[<span class="dv">1</span><span class="op">:</span><span class="dv">80</span>,])</code></pre>
<pre><code>## 
## Call:
## lm(formula = Ozone ~ Temp, data = air[1:80, ])
## 
## Coefficients:
## (Intercept)         Temp  
##    -136.474        2.306</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">9132</span>)
air &lt;-<span class="st"> </span><span class="kw">sample_n</span>(air, <span class="dv">116</span>)
<span class="kw">ggplot</span>(air[<span class="dv">1</span><span class="op">:</span><span class="dv">50</span>,], <span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&#39;lm&#39;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>)</code></pre>
<p><img src="06-extensiones-lineal_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>Y notamos un sesgo posible en nuestro modelo. Si coloreamos por velocidad del viento:</p>
<pre class="sourceCode r"><code class="sourceCode r">cuantiles &lt;-<span class="st"> </span><span class="kw">quantile</span>(air<span class="op">$</span>Wind)

<span class="kw">ggplot</span>(air[<span class="dv">1</span><span class="op">:</span><span class="dv">50</span>,], <span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone, <span class="dt">colour=</span> <span class="kw">cut</span>(Wind, cuantiles))) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&#39;lm&#39;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>)</code></pre>
<p><img src="06-extensiones-lineal_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>Nótese que parece ser que cuando los niveles de viento son altos, entonces
hay una relación más fuerte entre temperatura y Ozono. Esto es una <em>interacción</em>
de temperatura y viento.</p>
<p>Podemos hacer los siguiente: incluír un factor adicional, el producto
de temperatura con viento:</p>
<pre class="sourceCode r"><code class="sourceCode r">air<span class="op">$</span>temp_wind &lt;-<span class="st"> </span>air<span class="op">$</span>Temp<span class="op">*</span>air<span class="op">$</span>Wind
mod_<span class="dv">0</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(Ozone <span class="op">~</span><span class="st"> </span>Temp, <span class="dt">data =</span> air[<span class="dv">1</span><span class="op">:</span><span class="dv">50</span>,])
mod_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(Ozone <span class="op">~</span><span class="st"> </span>Temp <span class="op">+</span><span class="st"> </span>Wind, <span class="dt">data =</span> air[<span class="dv">1</span><span class="op">:</span><span class="dv">50</span>,])
mod_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(Ozone <span class="op">~</span><span class="st"> </span>Temp <span class="op">+</span><span class="st"> </span>Wind <span class="op">+</span><span class="st"> </span>temp_wind, air[<span class="dv">1</span><span class="op">:</span><span class="dv">50</span>,])
mod_<span class="dv">2</span></code></pre>
<pre><code>## 
## Call:
## lm(formula = Ozone ~ Temp + Wind + temp_wind, data = air[1:50, 
##     ])
## 
## Coefficients:
## (Intercept)         Temp         Wind    temp_wind  
##   -317.8272       4.8036      15.9498      -0.2311</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">pred_<span class="dv">0</span> &lt;-<span class="st"> </span><span class="kw">predict</span>(mod_<span class="dv">0</span>, <span class="dt">newdata =</span> air[<span class="dv">51</span><span class="op">:</span><span class="dv">116</span>,])
pred_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">predict</span>(mod_<span class="dv">1</span>, <span class="dt">newdata =</span> air[<span class="dv">51</span><span class="op">:</span><span class="dv">116</span>,])
pred_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">predict</span>(mod_<span class="dv">2</span>, <span class="dt">newdata =</span> air[<span class="dv">51</span><span class="op">:</span><span class="dv">116</span>,])
<span class="kw">mean</span>(<span class="kw">abs</span>(pred_<span class="dv">0</span><span class="op">-</span>air[<span class="dv">51</span><span class="op">:</span><span class="dv">116</span>,<span class="st">&#39;Ozone&#39;</span>]))</code></pre>
<pre><code>## [1] 19.88217</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(<span class="kw">abs</span>(pred_<span class="dv">1</span><span class="op">-</span>air[<span class="dv">51</span><span class="op">:</span><span class="dv">116</span>,<span class="st">&#39;Ozone&#39;</span>]))</code></pre>
<pre><code>## [1] 17.13767</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(<span class="kw">abs</span>(pred_<span class="dv">2</span><span class="op">-</span>air[<span class="dv">51</span><span class="op">:</span><span class="dv">116</span>,<span class="st">&#39;Ozone&#39;</span>]))</code></pre>
<pre><code>## [1] 15.52405</code></pre>
<p>Podemos interpretar el modelo con interacción de la siguiente forma:</p>
<ul>
<li>Si <span class="math inline">\(Wind = 5\)</span>, entonces la relación Temperatura Ozono es:
<span class="math display">\[ Ozono = -290 + 4.5Temp + 14.6(5) - 0.2(Temp)(5) = -217 + 3.5Temp\]</span></li>
<li>Si <span class="math inline">\(Wind=10\)</span>,
entonces la relación Temperatura Ozono es:
<span class="math display">\[ Ozono = -290 + 4.5Temp + 14.6(15) - 0.2(Temp)(15) = -71 + 1.5Temp\]</span></li>
</ul>
<p>Incluir interacciones en modelos lineales es buena idea para problemas con un número relativamente chico de variables (por ejemplo, <span class="math inline">\(p &lt; 10\)</span>).
En estos casos, conviene comenzar agregando interacciones entre variables que tengan efectos relativamente grandes en la predicción.
No es tan buena estrategia para un número grande de variables: por ejemplo, para clasificación de dígitos, hay 256 entradas. Poner todas las interacciones añadiría más de
30 mil variables adicionales, y es difícil escoger algunas para incluir en el modelo
a priori.</p>
<p>Pueden escribirse interacciones en fórmulas de <em>lm</em> y los cálculos se
hacen automáticamente:</p>
<pre class="sourceCode r"><code class="sourceCode r">mod_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(Ozone <span class="op">~</span><span class="st"> </span>Temp <span class="op">+</span><span class="st"> </span>Wind <span class="op">+</span><span class="st"> </span>Temp<span class="op">:</span>Wind, air[<span class="dv">1</span><span class="op">:</span><span class="dv">50</span>,])
mod_<span class="dv">3</span></code></pre>
<pre><code>## 
## Call:
## lm(formula = Ozone ~ Temp + Wind + Temp:Wind, data = air[1:50, 
##     ])
## 
## Coefficients:
## (Intercept)         Temp         Wind    Temp:Wind  
##   -317.8272       4.8036      15.9498      -0.2311</code></pre>
<hr />

<div class="comentario">
Podemos incluir interacciones para pares de variables que son importantes en la
predicción, o que por conocimiento del dominio sabemos que son factibles. Conviene
usar regularización si necesitamos incluir varias interacciones.
</div>

</div>
<div id="ejemplo-31" class="section level4 unnumbered">
<h4>Ejemplo</h4>
<p>En nuestro ejemplo de precios de casas ya habíamos intentado utilizar una interacción,
considerando el cociente de dos variables. Aquí veremos una que es importante:
la relación entre precio y superficie debe tener interacción con el vecindario,
pues distintos vecindarios tienen distintos precios por metro cuadrado:</p>
<pre class="sourceCode r"><code class="sourceCode r">agrupamiento &lt;-<span class="st"> </span>casas_e <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Neighborhood) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">media_ft2 =</span> <span class="kw">mean</span>(SalePrice <span class="op">/</span><span class="st"> </span>GrLivArea), <span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(media_ft2)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Neighborhood_grp =</span> <span class="kw">ifelse</span>(n <span class="op">&lt;</span><span class="st"> </span><span class="dv">60</span>, <span class="st">&#39;Other&#39;</span>, Neighborhood))
agrupamiento</code></pre>
<pre><code>## # A tibble: 25 x 4
##    Neighborhood media_ft2     n Neighborhood_grp
##    &lt;chr&gt;            &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;           
##  1 StoneBr           170.    16 Other           
##  2 NridgHt           167.    50 Other           
##  3 Veenker           155.     8 Other           
##  4 Timber            141.    27 Other           
##  5 Somerst           141.    61 Somerst         
##  6 CollgCr           137.    99 CollgCr         
##  7 Blmngtn           135.    13 Other           
##  8 NoRidge           132.    32 Other           
##  9 ClearCr           126.    20 Other           
## 10 Mitchel           126.    34 Other           
## # ... with 15 more rows</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">casas_e &lt;-<span class="st"> </span>casas_e <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(agrupamiento) </code></pre>
<pre><code>## Joining, by = &quot;Neighborhood&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">casas_p &lt;-<span class="st"> </span>casas_p <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(agrupamiento) </code></pre>
<pre><code>## Joining, by = &quot;Neighborhood&quot;</code></pre>
<p>En la siguiente gráfica ordenamos la variable <em>Neighborhood_grp</em> de manera
que aparecen antes vecindarios más baratos:</p>
<pre class="sourceCode r"><code class="sourceCode r">casas_e<span class="op">$</span>Neighborhood_grp &lt;-<span class="st"> </span><span class="kw">reorder</span>(casas_e<span class="op">$</span>Neighborhood_grp, casas_e<span class="op">$</span>media_ft2, mean)
<span class="kw">ggplot</span>(casas_e, 
       <span class="kw">aes</span>(<span class="dt">x=</span>GrLivArea, <span class="dt">y=</span>SalePrice, <span class="dt">colour=</span>Neighborhood_grp, <span class="dt">group=</span>Neighborhood_grp)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha=</span><span class="fl">0.1</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&#39;lm&#39;</span>, <span class="dt">se=</span><span class="ot">FALSE</span>, <span class="dt">size=</span><span class="fl">1.5</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_x_sqrt</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_sqrt</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">scale_colour_manual</span>(<span class="dt">values =</span> cbbPalette)</code></pre>
<p><img src="06-extensiones-lineal_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>Nótese que no solo las curvas se desplazan verticalmente según el
vecindario, sino que también su pendiente cambia con el vecindario. Podemos
agregar esta interacción a nuestro modelo:</p>
<pre class="sourceCode r"><code class="sourceCode r">mod_<span class="dv">6</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(SalePrice <span class="op">~</span><span class="st">  </span>OverallQual <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(OverallQual<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span>GrLivArea <span class="op">+</span><span class="st"> </span>TotalBsmtSF <span class="op">+</span>
<span class="st">                </span>GarageArea <span class="op">+</span><span class="st"> </span>OverallCond <span class="op">+</span><span class="st"> </span>CentralAir <span class="op">+</span><span class="st"> </span>BsmtQual <span class="op">+</span><span class="st"> </span>Neighborhood_grp <span class="op">+</span>
<span class="st">                </span>Neighborhood_grp<span class="op">:</span>GrLivArea, 
            <span class="dt">data =</span> casas_e)
<span class="kw">calc_error</span>(mod_<span class="dv">6</span>, casas_p, <span class="st">&quot;SalePrice&quot;</span>)</code></pre>
<p><img src="06-extensiones-lineal_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<pre><code>## [1] 25027.35</code></pre>
</div>
</div>
<div id="categorizacion-de-variables" class="section level2">
<h2><span class="header-section-number">6.5</span> Categorización de variables</h2>
<p>En categorización de variable, intentamos hacer un ajuste local en distintas partes del espacio de entrada. La idea es contruir cubetas, particionando el rango de una variable dada, y ajustar entonces un modelo usando la variable dummy indicadora de cada cubeta.</p>
<pre class="sourceCode r"><code class="sourceCode r">dat_wage &lt;-<span class="st"> </span>ISLR<span class="op">::</span>Wage 
<span class="kw">ggplot</span>(dat_wage, <span class="kw">aes</span>(<span class="dt">x=</span>age, <span class="dt">y=</span>wage)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre>
<p><img src="06-extensiones-lineal_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>Cuando la relación entre entradas y salida no es lineal, podemos obtener menor
sesgo en nuestros
modelos usando esta técnica. En este ejemplo, escogimos edades de corte
aproximadamente separadas por 10 años, por ejemplo:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#cuantiles_age &lt;- quantile(dat_wage$age, probs=seq(0,1,0.2))</span>
<span class="co">#cuantiles_age</span>
dat_wage &lt;-<span class="st"> </span>dat_wage <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age_cut =</span> <span class="kw">cut</span>(age, <span class="kw">c</span>(<span class="dv">18</span>, <span class="dv">25</span>, <span class="dv">35</span>, <span class="dv">45</span>, <span class="dv">55</span>, <span class="dv">65</span>, <span class="dv">80</span>), <span class="dt">include.lowest=</span><span class="ot">TRUE</span>))
<span class="kw">head</span>(dat_wage)</code></pre>
<pre><code>##   year age           maritl     race       education             region
## 1 2006  18 1. Never Married 1. White    1. &lt; HS Grad 2. Middle Atlantic
## 2 2004  24 1. Never Married 1. White 4. College Grad 2. Middle Atlantic
## 3 2003  45       2. Married 1. White 3. Some College 2. Middle Atlantic
## 4 2003  43       2. Married 3. Asian 4. College Grad 2. Middle Atlantic
## 5 2005  50      4. Divorced 1. White      2. HS Grad 2. Middle Atlantic
## 6 2008  54       2. Married 1. White 4. College Grad 2. Middle Atlantic
##         jobclass         health health_ins  logwage      wage age_cut
## 1  1. Industrial      1. &lt;=Good      2. No 4.318063  75.04315 [18,25]
## 2 2. Information 2. &gt;=Very Good      2. No 4.255273  70.47602 [18,25]
## 3  1. Industrial      1. &lt;=Good     1. Yes 4.875061 130.98218 (35,45]
## 4 2. Information 2. &gt;=Very Good     1. Yes 5.041393 154.68529 (35,45]
## 5 2. Information      1. &lt;=Good     1. Yes 4.318063  75.04315 (45,55]
## 6 2. Information 2. &gt;=Very Good     1. Yes 4.845098 127.11574 (45,55]</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">mod_age &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span><span class="st"> </span>age_cut, <span class="dt">data=</span>dat_wage)
mod_age</code></pre>
<pre><code>## 
## Call:
## lm(formula = wage ~ age_cut, data = dat_wage)
## 
## Coefficients:
##    (Intercept)  age_cut(25,35]  age_cut(35,45]  age_cut(45,55]  
##          76.28           27.88           42.79           41.34  
## age_cut(55,65]  age_cut(65,80]  
##          42.73           26.27</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">dat_wage<span class="op">$</span>pred_wage &lt;-<span class="st"> </span><span class="kw">predict</span>(mod_age)
<span class="kw">ggplot</span>(dat_wage) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x=</span>age, <span class="dt">y=</span>wage)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>age, <span class="dt">y=</span>pred_wage), <span class="dt">colour =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">size=</span><span class="fl">1.1</span>)</code></pre>
<p><img src="06-extensiones-lineal_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<ul>
<li>Podemos escoger los puntos de corte en lugares que son razonables para el problema
(rangos en los es razonable modelar como una constante).</li>
<li>También podemos hacer cortes automáticos usando percentiles de los datos: por ejemplo,
cortar en cuatro usando los percentiles 25%, 0.5% y 0.75%. Con más datos es posible
incrementar el número de cortes.</li>
<li>Nótese que cuando hacemos estas categorizaciones estamos incrementando el
número de parámetros a estimar del modelo (si hacemos tres cortes, por ejemplo, aumentamos
en 3 el número de parámetros).</li>
</ul>

<div class="comentario">
Las categorizaciones de variables son útiles cuando sabemos que hay efectos
no lineales de la variable subyacente (por ejemplo, edad o nivel socioeconómico),
y las categorías son suficientemente chicas para que el modelo localmente constante
sea razonable.
</div>

<p>Muchas veces los splines son mejores opciones:</p>
</div>
<div id="splines-opcional" class="section level2">
<h2><span class="header-section-number">6.6</span> Splines (opcional)</h2>
<p>En estos ejemplos, también es posible incluir términos cuadráticos para modelar
la relación, por ejemplo:</p>
<pre class="sourceCode r"><code class="sourceCode r">dat_wage<span class="op">$</span>age_<span class="dv">2</span> &lt;-<span class="st"> </span>dat_wage<span class="op">$</span>age<span class="op">^</span><span class="dv">2</span>
mod_age &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>age_<span class="dv">2</span>, <span class="dt">data=</span>dat_wage)
mod_age</code></pre>
<pre><code>## 
## Call:
## lm(formula = wage ~ age + age_2, data = dat_wage)
## 
## Coefficients:
## (Intercept)          age        age_2  
##   -10.42522      5.29403     -0.05301</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">dat_wage<span class="op">$</span>pred_wage &lt;-<span class="st"> </span><span class="kw">predict</span>(mod_age)
<span class="kw">ggplot</span>(dat_wage) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x=</span>age, <span class="dt">y=</span>wage)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>age, <span class="dt">y=</span>pred_wage), <span class="dt">colour =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">size=</span><span class="fl">1.1</span>)</code></pre>
<p><img src="06-extensiones-lineal_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Estas dos técnicas para hacer más flexible el modelo lineal tienen
algunas deficiencias:</p>
<ul>
<li>Muchas veces usar potencias de variables de entrada es una mala idea, pues
fácilmente podemos encontrar problemas numéricos (potencias altas pueden
dar valores muy chicos o muy grandes).</li>
<li>La categorización de variables numéricas puede resultar en predictores
con discontinuidades, lo cual no siempre es deseable (interpretación).</li>
</ul>
<p>Una alternativa es usar <em>splines</em>, que son familias de funciones con buenas propiedades
que nos permiten hacer expansiones del espacio de entradas. No las veremos con
detalle, pero aquí hay unos ejemplos:</p>
<p>Por ejemplo, podemos usar B-spines, que construyen “chipotes” en distintos
rangos de la variable de entrada (es como hacer categorización, pero con
funciones de respuesta suaves):</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(splines2)
age &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">18</span>,<span class="dv">80</span>, <span class="fl">0.2</span>)
splines_age  &lt;-<span class="st"> </span><span class="kw">bSpline</span>(age, 
                         <span class="dt">knots =</span> <span class="kw">c</span>(<span class="dv">25</span>, <span class="dv">35</span>, <span class="dv">45</span>, <span class="dv">55</span>, <span class="dv">65</span>),
                         <span class="dt">degree =</span> <span class="dv">3</span>)
<span class="kw">matplot</span>(<span class="dt">x =</span> age, <span class="dt">y =</span> splines_age, <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>)</code></pre>
<p><img src="06-extensiones-lineal_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p><strong>Observación</strong>: estos splines son como una versión suave de categorización
de variables numéricas. En particular, los splines de grado 0 son justamente
funciones que categorizan variables:</p>
<pre class="sourceCode r"><code class="sourceCode r">splines_age  &lt;-<span class="st"> </span><span class="kw">bSpline</span>(age, 
                         <span class="dt">knots =</span> <span class="kw">c</span>(<span class="dv">25</span>, <span class="dv">35</span>, <span class="dv">45</span>, <span class="dv">55</span>, <span class="dv">65</span>),
                         <span class="dt">degree =</span> <span class="dv">0</span>)
<span class="kw">matplot</span>(splines_age, <span class="dt">type=</span><span class="st">&#39;l&#39;</span>)</code></pre>
<p><img src="06-extensiones-lineal_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>Por ejemplo: si expandimos el espacio de entradas con estos splines y
corremos el modelo:</p>
<pre class="sourceCode r"><code class="sourceCode r">dat_wage &lt;-<span class="st"> </span>ISLR<span class="op">::</span>Wage 
splines_age  &lt;-<span class="st"> </span><span class="kw">bSpline</span>(dat_wage<span class="op">$</span>age, 
                         <span class="dt">knots =</span> <span class="kw">c</span>(<span class="dv">25</span>, <span class="dv">35</span>, <span class="dv">45</span>, <span class="dv">65</span>),
                         <span class="dt">degree =</span> <span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span>data.frame
<span class="kw">colnames</span>(splines_age) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;spline_&#39;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>)
dat_wage &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(dat_wage, splines_age)
dat_sp &lt;-<span class="st"> </span>dat_wage <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(wage, <span class="kw">contains</span>(<span class="st">&#39;spline&#39;</span>))
<span class="kw">head</span>(dat_sp)</code></pre>
<pre><code>##        wage  spline_1    spline_2   spline_3  spline_4   spline_5
## 1  75.04315 0.0000000 0.000000000 0.00000000 0.0000000 0.00000000
## 2  70.47602 0.4555974 0.474260292 0.06722689 0.0000000 0.00000000
## 3 130.98218 0.0000000 0.000000000 0.33333333 0.5925926 0.07407407
## 4 154.68529 0.0000000 0.001481481 0.44018519 0.5204074 0.03792593
## 5  75.04315 0.0000000 0.000000000 0.14062500 0.6272321 0.22704082
## 6 127.11574 0.0000000 0.000000000 0.05545833 0.5406104 0.37417611
##      spline_6
## 1 0.000000000
## 2 0.000000000
## 3 0.000000000
## 4 0.000000000
## 5 0.005102041
## 6 0.029755102</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">mod_age &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span>. , <span class="dt">data=</span>dat_sp)
mod_age</code></pre>
<pre><code>## 
## Call:
## lm(formula = wage ~ ., data = dat_sp)
## 
## Coefficients:
## (Intercept)     spline_1     spline_2     spline_3     spline_4  
##      65.044        1.464       27.176       54.472       52.121  
##    spline_5     spline_6  
##      58.230       31.771</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">dat_wage<span class="op">$</span>pred_wage &lt;-<span class="st"> </span><span class="kw">predict</span>(mod_age)
<span class="kw">ggplot</span>(dat_wage) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x=</span>age, <span class="dt">y=</span>wage)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>age, <span class="dt">y=</span>pred_wage), <span class="dt">colour =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">size=</span><span class="fl">1.1</span>)</code></pre>
<p><img src="06-extensiones-lineal_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>O podemos usar i-splines (b-splines integrados), por ejemplo:</p>
<pre class="sourceCode r"><code class="sourceCode r">splines_age  &lt;-<span class="st"> </span><span class="kw">iSpline</span>(age, 
                         <span class="dt">knots =</span> <span class="kw">c</span>(<span class="dv">25</span>, <span class="dv">35</span>, <span class="dv">45</span>, <span class="dv">65</span>),
                         <span class="dt">degree =</span> <span class="dv">2</span>)
<span class="kw">matplot</span>(splines_age, <span class="dt">type=</span><span class="st">&#39;l&#39;</span>)</code></pre>
<p><img src="06-extensiones-lineal_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r">dat_wage &lt;-<span class="st"> </span>ISLR<span class="op">::</span>Wage 
splines_age  &lt;-<span class="st"> </span><span class="kw">iSpline</span>(dat_wage<span class="op">$</span>age, 
                         <span class="dt">knots =</span> <span class="kw">c</span>(<span class="dv">25</span>, <span class="dv">35</span>, <span class="dv">45</span>, <span class="dv">65</span>),
                         <span class="dt">degree =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span>data.frame
<span class="kw">colnames</span>(splines_age) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;spline_&#39;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>)
dat_wage &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(dat_wage, splines_age)
dat_sp &lt;-<span class="st"> </span>dat_wage <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(wage, <span class="kw">contains</span>(<span class="st">&#39;spline&#39;</span>))
<span class="kw">head</span>(dat_sp)</code></pre>
<pre><code>##        wage  spline_1   spline_2  spline_3   spline_4    spline_5 spline_6
## 1  75.04315 0.0000000 0.00000000 0.0000000 0.00000000 0.000000000        0
## 2  70.47602 0.5414872 0.06722689 0.0000000 0.00000000 0.000000000        0
## 3 130.98218 1.0000000 1.00000000 0.6666667 0.07407407 0.000000000        0
## 4 154.68529 1.0000000 0.99851852 0.5583333 0.03792593 0.000000000        0
## 5  75.04315 1.0000000 1.00000000 0.8593750 0.23214286 0.005102041        0
## 6 127.11574 1.0000000 1.00000000 0.9445417 0.40393122 0.029755102        0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">mod_age &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span>. , <span class="dt">data=</span>dat_sp)
mod_age</code></pre>
<pre><code>## 
## Call:
## lm(formula = wage ~ ., data = dat_sp)
## 
## Coefficients:
## (Intercept)     spline_1     spline_2     spline_3     spline_4  
##      64.643       28.331       26.442       -2.510        7.600  
##    spline_5     spline_6  
##     -31.903       -5.441</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">dat_wage<span class="op">$</span>pred_wage &lt;-<span class="st"> </span><span class="kw">predict</span>(mod_age)
<span class="kw">ggplot</span>(dat_wage) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x=</span>age, <span class="dt">y=</span>wage)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>age, <span class="dt">y=</span>pred_wage), <span class="dt">colour =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">size=</span><span class="fl">1.1</span>)</code></pre>
<p><img src="06-extensiones-lineal_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
</div>
<div id="modelando-en-escala-logaritmica" class="section level2">
<h2><span class="header-section-number">6.7</span> Modelando en escala logarítmica</h2>
<p>En muchos problemas, es natural transformar variables numéricas con el logaritmo.
Supongamos por ejemplo que en nuestro problema la variable <span class="math inline">\(y\)</span> es positiva,
y también las entradas son positivas. En primer lugar podríamos intentar modelar
<span class="math display">\[ y =  b_0 + \sum b_j x_j \]</span>
pero también podemos transformar las entradas y la salida para construir un
modelo multiplicativo:
<span class="math inline">\(y&#39; = log(y) = b_0 + \sum b_k \log(x_j)\)</span>
y ahora queremos predecir el logaritmo de <span class="math inline">\(y\)</span>, no <span class="math inline">\(y\)</span> directamente.</p>
<p>Esta tipo de transformación tiene dos efectos:</p>
<ul>
<li>Convierte modelos aditivos (regresión lineal) en modelos multiplicativos en
las variables no transformadas (pero lineales en escala logarítmica). Esta estructura
tiene más sentido para algunos problemas, y es más razonable que la forma lineal
aplique para este tipo de problemas.</li>
<li>Comprime la parte superior de la escala en relación a la parte baja, y esto es útil
para aminorar el efecto de valores atípicos grandes (que puede tener malos efectos
numéricos y también pueden producir que los atipicos dominen el error o la estimación
de los coeficientes).</li>
</ul>
<div id="ejemplo-32" class="section level4 unnumbered">
<h4>Ejemplo</h4>
<p>Consideramos predecir el quilataje de</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">22</span>)
diamonds_muestra &lt;-<span class="st"> </span><span class="kw">sample_n</span>(diamonds, <span class="dv">1000</span>)
<span class="kw">ggplot</span>(diamonds_muestra, <span class="kw">aes</span>(<span class="dt">x=</span>carat, <span class="dt">y=</span>price)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>)</code></pre>
<p><img src="06-extensiones-lineal_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<p>Nótese que el modelo lineal está sesgado, y produce sobrestimaciones y subestimaciones
para distintos valores de <span class="math inline">\(x\)</span>. Aunque podríamos utilizar un método más flexible para
este modelo, una opción es transformar entrada y salida con logaritmo:</p>
<pre class="sourceCode r"><code class="sourceCode r">diamonds_muestra &lt;-<span class="st"> </span>diamonds_muestra <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">log_price =</span> <span class="kw">log</span>(price), <span class="dt">log_carat =</span> <span class="kw">log</span>(carat))
<span class="kw">ggplot</span>(diamonds_muestra, <span class="kw">aes</span>(<span class="dt">x=</span>log_carat, <span class="dt">y=</span>log_price)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</code></pre>
<p><img src="06-extensiones-lineal_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>Podemos
graficar también en unidades originales:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds_muestra, <span class="kw">aes</span>(<span class="dt">x=</span>carat, <span class="dt">y=</span>price<span class="op">/</span><span class="dv">1000</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&#39;lm&#39;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">breaks=</span><span class="dv">2</span><span class="op">^</span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_log10</span>(<span class="dt">breaks=</span><span class="dv">2</span><span class="op">^</span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">1</span>))</code></pre>
<p><img src="06-extensiones-lineal_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<p>Y vemos que la relación entre los logaritmos es lineal: redujimos el sesgo
sin los costos adicionales de varianza que implica agregar más variables
e interacciones. En este caso, esta relación es naturalmente multiplicativa
(un 10% de incremento relativo en el peso produce un incremento constante
en el precio).</p>

<div class="comentario">
<ul>
<li>Cuando una variable <em>toma valores positivos y recorre varios órdenes
de magnitud</em>,
puede ayudar transformar con logaritmo o
raíz cuadrada (esto incluye transformar la variable respuesta).</li>
<li>Muchas veces es natural modelar en la escala logarítmica, como en el ejemplo
de los diamantes.</li>
<li>También tiene utilidad cuando las variables de respuesta o entrada tienen distribuciones
muy sesgadas a la derecha (con algunos valores órdenes de magnitud más grandes que la mayoría
del grueso de los datos). Tomar logaritmos resulta en mejoras numéricas, y
evita que algunos valores atipicos dominen el cálculo del error.</li>
<li>Menos común: variables que son proporciones <span class="math inline">\(p\)</span> pueden transformarse mediante la
transformación inversa de la logística (<span class="math inline">\(x = \log(\frac{p}{1-p})\)</span>.)
</div></li>
</ul>
<hr />
<p><strong>Discusión</strong>:</p>
<p>En un modelo lineal usual, tenemos que si cambiamos <span class="math inline">\(x_j \to x_j + \Delta x\)</span>,
entonces la predicción <span class="math inline">\(y\)</span> tiene un cambio de
<span class="math display">\[\Delta y = b_j \Delta x.\]</span></p>
<p>Es decir, mismos cambios absolutos en alguna variable de entrada produce
mismos cambios absolutos en las predicciones, independientemente del nivel
de las entradas.</p>
<p>Sin embargo, el modelo logarítmico es multiplicativo,
pues tomando exponencial de ambos lados, obtenemos:</p>
<p><span class="math display">\[y = B_0\prod x_j^{b_j}\]</span>
Entonces, si cambiamos <span class="math inline">\(x_j \to x_j + \Delta x\)</span>,
el cambio porcentual en <span class="math inline">\(y\)</span> es
<span class="math display">\[ \frac{y+\Delta y}{y} = \left ( \frac{x_j +\Delta x}{x_j}\right )^{b_j}\]</span></p>
<p>De modo que mismos cambios porcentuales en <span class="math inline">\(x\)</span> resultan en los mismos cambios
porcentuales de <span class="math inline">\(y\)</span>, independientemente del nivel de las entradas.</p>
<p>Adicionalmente, es útil notar que si
<span class="math inline">\(\frac{\Delta x}{x_j}\)</span> es chica, entonces aproximadamente
<span class="math display">\[ \frac{\Delta y}{y} \approx b_j \frac{\Delta x}{x_j}\]</span>
Es decir, el cambio relativo en <span class="math inline">\(y\)</span> es proporcional al cambio relativo en <span class="math inline">\(x_j\)</span> para
cambios relativamente chicos en <span class="math inline">\(x_j\)</span>, y el coeficiente es la constante de
proporcionalidad</p>
<hr />
</div>
<div id="ejercicio-5" class="section level4 unnumbered">
<h4>Ejercicio</h4>
<p>Puedes repetir el ejercicio de la tarea 6 transformando las variables numéricas
con logaritmo (o <span class="math inline">\(\log(1+x)\)</span> cuando <span class="math inline">\(x\)</span> tiene ceros).
Utiliza el mismo error del concurso de kaggle, que es el error cuadrático medio
en escala logarítmica (en el concurso, esta es otra razón para usar escala
logarítmica en la variable respuesta.)</p>
</div>
<div id="cuando-usar-estas-tecnicas" class="section level3">
<h3><span class="header-section-number">6.7.1</span> ¿Cuándo usar estas técnicas?</h3>
<p>Estas técnicas pueden mejorar considerablemente nuestros modelos lineales, pero
a veces puede ser difícil descubrir exactamente que transformaciones pueden ser
útiles, y muchas veces requiere conocimiento experto del problema que
enfrentamos. En general,</p>
<ul>
<li>Es mejor usar regularización al hacer este tipo de trabajo,
para protegernos de varianza alta cuando incluimos varias entradas derivadas.</li>
<li>Es buena idea probar incluir interacciones entre variables que tienen efectos grandes en la predicción, o interacciones que creemos son importantes en nuestro problema (por ejemplo,
temperatura y viento en nuestro ejemplo de arriba, o existencia de estacionamiento y
tráfico vehicular como en nuestro ejemplo de predicción de ventas de una tienda).</li>
<li>Gráficas como la de arriba (entrada vs respuesta) pueden ayudarnos a decidir
si conviene categorizar alguna variable o añadir un efecto no lineal.</li>
</ul>
<p>Este es un trabajo que no es tan fácil, pero para problema con relativamente pocas
variables es factible. En situaciones con muchas variables de entrada
y muchos datos, existen mejores opciones.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="regularizacion.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="redes-neuronales-parte-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/felipegonzalez/aprendizaje-maquina-mcd/edit/master/06-extensiones-lineal.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
